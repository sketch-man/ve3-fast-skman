<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF‑8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Veo 3 Fast Mini App</title>
    <style>
      body {
        font‑family: Arial, sans‑serif;
        background: #f8f9fa;
        padding: 20px;
        color: #333;
      }
      h1 {
        font‑size: 1.5rem;
        margin‑bottom: 0.5rem;
      }
      .container {
        max‑width: 480px;
        margin: 0 auto;
        background: #fff;
        padding: 20px;
        border‑radius: 8px;
        box‑shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      label {
        font‑weight: bold;
        display: block;
        margin‑top: 12px;
        margin‑bottom: 4px;
      }
      textarea {
        width: 100%;
        height: 120px;
        padding: 8px;
        resize: vertical;
        border: 1px solid #ccc;
        border‑radius: 4px;
      }
      input[type="file"] {
        width: 100%;
        margin‑top: 4px;
      }
      button {
        display: block;
        width: 100%;
        padding: 12px;
        margin‑top: 16px;
        background: #007bff;
        color: #fff;
        border: none;
        border‑radius: 4px;
        font‑size: 1rem;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .note {
        font‑size: 0.9rem;
        margin‑top: 8px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Создание Veo 3 Fast видео</h1>
      <p class="note">
        Введите описание и (при желании) загрузите изображение, чтобы создать
        видео Veo 3. После отправки мини‑приложение вернёт эти данные вашему
        Telegram‑боту.
      </p>
      <label for="prompt">Описание (промпт)</label>
      <textarea id="prompt" placeholder="Например, A happy dog playing in a park"></textarea>

      <label for="image">Изображение (необязательно)</label>
      <input id="image" type="file" accept="image/*" />

      <button id="send">Отправить боту</button>

      <p class="note">
        ⚠️ Если вы загружаете изображение, оно должно быть доступно по URL.
        Для этого потребуется сервер или облачное хранилище. Функция
        <code>uploadFileToServer()</code> (смотрите код) вызывается для
        загрузки, её нужно реализовать на сервере. Мини‑приложение
        передаёт в бота лишь ссылку на изображение.
      </p>
    </div>
    <script>
      // Убедитесь, что Telegram Web App готово к работе
      window.addEventListener('DOMContentLoaded', () => {
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.ready();
        }
      });

      /**
       * Загружает выбранный файл на ваш сервер или облако.
       * Вы должны реализовать этот метод: загрузить файл, получить
       * публичный URL и вернуть его. По умолчанию просто возвращает
       * undefined, что означает, что изображения нет.
       * @param {File} file
       * @returns {Promise<string|undefined>}
       */
      async function uploadFileToServer(file) {
        if (!file) return undefined;
        // TODO: здесь нужно реализовать загрузку файла на сервер и
        // возврат публичной ссылки. Например, можно отправить файл
        // через fetch() на ваш API и получить URL ответа.
        // Ниже пример шаблона:
        //
        // const formData = new FormData();
        // formData.append('file', file);
        // const response = await fetch('https://yourdomain.com/upload', {
        //   method: 'POST',
        //   body: formData
        // });
        // const result = await response.json();
        // return result.url;
        //
        // Пока возвращаем undefined (изображения нет)
        return undefined;
      }

      document.getElementById('send').addEventListener('click', async () => {
        const prompt = document.getElementById('prompt').value.trim();
        const imageFile = document.getElementById('image').files[0];
        // Проверяем наличие описания или изображения
        if (!prompt && !imageFile) {
          alert('Пожалуйста, введите описание или загрузите изображение.');
          return;
        }
        // Загружаем изображение (если есть) и получаем URL
        let imageUrl;
        try {
          imageUrl = await uploadFileToServer(imageFile);
        } catch (err) {
          alert(
            'Ошибка загрузки изображения. Проверьте соединение и попробуйте ещё раз.'
          );
          return;
        }
        // Собираем данные
        const data = { prompt };
        if (imageUrl) {
          data.imageUrl = imageUrl;
        }
        // Отправляем данные в Telegram‑бот
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.sendData(JSON.stringify(data));
        } else {
          alert(
            'Telegram WebApp не инициализирован. Попробуйте обновить страницу.'
          );
        }
      });
    </script>
  </body>
</html>